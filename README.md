database
========

2014 DB class Homeworks and project
----

Homework 2
---
1. User interface
    - Login page
        - User should login with account & password
        - Provide a link to register page
        - Use sessions to implement login
    - Register page
        - Identities includes admin and user
        - Account & password must be set up correctly
            - account should be unique, and empty string or whitespace are not allowed
            - password cannot be empty string
            - password should be encrypted with hashing
            - After successful registration, redirect to login page. Otherwise, stay in registration page.
    - After logged in, user will be redirected to different page according to their identity

2. Identity
    - There are 2 identities in this system: user, admin
    - For user, refer to part 3
    - For admin, refer to part 4

3. User page
    - Show information of all flights
        - Flight information should include id, flight number, departure, destination, departure date, arrival date
    - Logout
        - After logged out, redirect to login page

4. Admin page
    - Show information of all flights (same as user)
        - Flight information include id, flight number, departure, destination, departure date, arrival date
    - Logout(same as user)
        - After logged out, redirect to login page
    - Flight management
        - Create new flight information
            - New flight information should include following data: flight number, departure, destination, departure date, arrival date. Empty string or whitespace are not allowed.
            - Id should be auto-generated by system
        - Update flight information
            - Admin can edit flight number, departure, destination, departure date, arrival date of a flight
            - Empty string or whitespace are not allowed.
            - Id cannot be updated
        - Delete flight information
        
Homework 3
---
1.  Brief introduction
    - This is the extension of hw2.
    - Add "ticket price" to the flight information table.
    - Two extra demands for the admin.
    - New: comparison sheet!
        - User may add their preferred flights to the comparison sheet.
    - Please remove the capability of users to register as the admin.
    - The design of the table and the implementation of foreign key are parts of the project.

2. Comparison sheet
    - Each user maintains their own comparison sheet.
    - table display
        - The displayed columns are the same as the columns of flights.
    - Sheets management
        - Create: refer to part 3
        - Delete: remove any flight from the sheet.
        - Sort: sort columns by certain attribute.
            - Columns include "departure date", "arrival date", and "price"
            - If the values of selected attribute are the same, sort them by flight no. (in alphabetical order)
            - Sort the flight information in ascending/descending order.

3. Flight sheet
    - Check all flights information.
        - Columns include "flight no", "departure"," destination", "departure date", "arrival date", and "price".
        - Sorting and searching the flight information are required.
    - Sort: sort columns by certain attribute.
        - If the values of selected attribute are the same, sort them by flight no. (in alphabetical order)
        - Sort the flight information in ascending/descending order.
    - Search: list the satisfied flights with selected attribute and sort them orderly.
        - Columns includes “flight no”, “departure”, and “destination”.
        - Sort the flight information in ascending/descending order according to “departure date”, “arrival date”, or “price”.
    - Add flights into the comparison sheet.

4. User page
    - Look up the comparison sheet. (Refer to part 2)
    - Look up the flight information table. (Refer to part 3)

5.  Admin authority
    - Look up the comparison sheet. (Refer to part 2)
    - Look up the flight information table. (Refer to part 3)
    - (new) admin authority
        - Look up the user list.
        - The displayed columns include “account” and “identity”.
        - Add new users.
            - The identity may be admin or user.
            - The format of password and account refers to hw2.
        - Delete the user.
            - User’s comparison sheet should be deleted as he is removed from user list.
            - The user is forced to logout as he does any further actions.
        - Edit the user.
            - Admin can only modify the authority of the users.
            - The modified authority will come into effect after user logout.
    - (new) airport management
        - The list of airport location.
            - List the location of airports.
        - Add new airport.
            - Provided information includes “name”, “longitude”, and ”latitude”.
            - The format of “longitude” and “latitude” are (41.40338, 2.17403) .
        - Edit the airport data.
            - Update the value of “name”, “longitude”, and “latitude”.
        - Delete the airport.
            - When admin delete some location of the airport, any flight information including the deleted place should be removed accordingly.
            - Correspondingly, if the flight was added to someone’s comparison sheet, it should be removed, too.
    - (modified) flight management
        - The value of “departure” and “destination” must be valid when creating new flights.
        - Otherwise, the update fails.

Homework 4
---

1. Brief introduction 
	- This homework is the extension of hw3.

	- Table schema adjustment.(See part2 for details.)

	- Add new Entity: Country that has attrubutes  attributes “abbreviation” and “fullname”. 

	- Add “belonging Country”, “full name”, and “Timezone” attributes into airport information. 

	- Two new features for administrator (see part 4 for details) 
		- Country list management 
		- Airport management: refer to 4.2 
		
	- New feature: Ticket searching (see part 3 for details) 

2. Table schema adjustment 
	- All tables are required to be normalized by the Third normal form(3NF) 

	- The definition of arrival/departure time in flights 
	 -The timezone of departure time is the departure airport’s timezone; 
		The timezone of arrival time is the destination airport’s timezone. 

3. Ticket searching 
	- Tickets 
		-There may be more than one flights during the trip from A to B. 
		-Transfers are needed for a trip with more than 1 flight.
	- User restriction 
		-Guest can search the ticket information without logging in. 
	- Searching 
		-Find out all the qualified ticket with the given condition: Departure airport full name, 
		 destination airport full name, and the upper limit of transfer time. 
	  
		-Sort the airport list by country 
		
		-Transfer times can be chosen: No transfer, No more than 1, No more than 2 
	- Search result  
		-you need to display the following infomation 
			-Flight number
			-Abbreviation of departure airport 
	 		-Abbreviation of destination airport 
			-Departure time(local time) 
			-Arrival time(local time) 
			-Flight time 
				-Please take the time difference into account.
				(Hint: you may convert the timezone of arrival time into departure airport’s timezone, 
				and subtract it with departure time) 

				-You should display the flight information(including flight no, abbreviation of departure/destination airport, 
				departure/arrival time, flight time) of each transit flight in the connecting flight. 

			-Transfer time(there is no time difference problem to be concerned) Please refer to part 3.5)
			
			-Price (Please refer to part 3.5)

			-Order 
				-Order by price  
				-Order by departure time 
				-Order by arrival time 

	- Transfer 
		-Airline companies may split a long-term journey into multiple short-term journey. 
			-For example, Taiwan to UK can be split into Taiwan to HongKong, than HongKong to UK. 
	 	-Transfer times is no more than twice. 
	 
		-Tourist may get discount of tickets as the time of transfer goes up: 
			-Direct flight: No discount 
			-Transfer once: 
				10% off for the total price of two flights 
			-Transfer twice: 
				20% off for the total price of three flights 

		-There is at least two-hour layover between two flights. 
	- Restrictions on Implementations 
		-The computation of following attributes is required to be computed by Date/Time functions in SQL (reference) 
			-Flight time  
			-Transfer time 	
		-Use only ONE SQL command during the whole transfer process. Sorting in other programming language or 
		use more than one SQL command is not allowed. In other words, you should query all the matched direct flights 
		or connecting flights information including flight id, total flight time, overall price (discounted) 
		and total transfer time in ONE SQL command. However, the individual departure/arrival date, departure/arrival airport, 
		flight time and transfer time in the connecting flight is not constrained. 
			-The following hints are for reference, not requirement:
			SELECT flight id1, flight id2, flight id3,Arrival time1, Transfer time1, price1 
			FROM ( SQL of direct flight UNION SQL of transfer once2 UNION SQL of transfer twice2 )3 AS TransferTable 
			ORDER BY price / arrival time / transfer time  
			- You may use “CASE WHEN” to select results according to different value. 
				Here is the example: 
				CASE WHEN {condition} THEN {value} WHEN {condition} THEN {value} ELSE {value} END 
	 		- You may use “JOIN” in the transfer SQL  
			- You can only use UNION when the number of columns for each SQL are the same. You may 
				“SELECT NULL AS columName” to fill the empty column. 
				For example, there will be no flight id2 and flight id3 in SQL of direct flight. 
				You may SELECT NULL for them. 
				Date time related function in SQL: (reference) 

4.Administrator 
	- Country list management 
		-List the countries 	 
		-Add new country 
			-The format of the abbreviation of a country will only have three capital letters (ex: TWN). 
		-Full name 
		-Edit 
			-You can edit the abbreviation and full name of a country. 
		-Deletion 
	 		-The corresponding information about country should be removed once the country was deleted. 
	- Airport management 
		-Add new attributes to airport  
			-Belonging country (Implement by foreign key )
		-Full name  
		-Timezone, ex: +08:00 

5. Bonus 
	- Round-trip tickets
	- Overnight / Not overnight options in Transfer
	  -You should define what is overnight in your report 
			Ex. Transfer time in one transit airport is larger than 12 hours 
	- The total time of the journey 
		-total time of the journey = total transfer time + total flight time 
		-The result of search can sort by ”total journey time”, “total flight time” or “total transfer time”. 
	- Comparison sheet 
		-Comparison sheet modification: add a ticket into it instead of a flight. 
		-Only Logged-in user can add ticket into comparison sheet during their searching. 
	- Other 
